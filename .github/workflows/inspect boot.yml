name: Inspect Boot Image

on:
  workflow_dispatch:
    inputs:
      mediafire_url:
        description: "MediaFire share link"
        required: true
        type: string

jobs:
  inspect:
    runs-on: ubuntu-latest

    steps:
      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y wget curl unzip grep sed

      - name: Download magiskboot
        run: |
          wget -q https://github.com/topjohnwu/Magisk/releases/latest/download/magiskboot-linux.zip
          unzip -o magiskboot-linux.zip
          chmod +x magiskboot

      - name: Resolve MediaFire direct link
        id: resolve
        run: |
          URL="${{ github.event.inputs.mediafire_url }}"
          PAGE=$(curl -L -s "$URL")
          DIRECT=$(echo "$PAGE" | grep -o 'https://download[^"]*' | head -n1)
          echo "direct_link=$DIRECT" >> $GITHUB_OUTPUT

      - name: Download boot.img
        run: |
          wget -O boot.img "${{ steps.resolve.outputs.direct_link }}"

      - name: Check file
        run: |
          file boot.img
          ls -lh boot.img

      - name: Unpack boot image
        run: |
          ./magiskboot unpack boot.img || true

      - name: Print header info
        run: |
          ./magiskboot unpack -h boot.img || true